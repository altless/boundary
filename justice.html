<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="css/default.css">
    <style>
        /* .no-drag {-ms-user-select: none; -moz-user-select: -moz-none; -webkit-user-select: none; -khtml-user-select: none; user-select:none;} */
        body {
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: row;
            align-items: center;
            background: blue;
        }

        #draggable {
            width: auto;
            height: 2.5vh;
            text-align: center;
            background: transparent;
        }

        #poem-box {
            -ms-user-select: none;
            -moz-user-select: -moz-none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            user-select: none;
            width: 20vw;
            height: 80vh;
            background-color: black;
            color: blanchedalmond;
            font-size: 0.75rem;
        }

        .dropzone-house {
            -ms-user-select: none;
            -moz-user-select: -moz-none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            user-select: none;
            display: flex;
            justify-content: center;
            width: 80vw;
            height: 80vh;
        }

        .left-dropzone {
            -ms-user-select: none;
            -moz-user-select: -moz-none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            user-select: none;
            width: 40vw;
            height: 80vh;
        }

        .right-dropzone {
            -ms-user-select: none;
            -moz-user-select: -moz-none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            user-select: none;
            width: 40vw;
            height: 80vh;
        }

        .dropzone-house #draggable {
            padding: 0;
        }

        #left-field {
            background: chartreuse;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
        }

        #right-field {
            background: coral;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="dropzone-house">
            <div class="left-dropzone" id="left-field"></div>
            <div class="right-dropzone" id="right-field"></div>
        </div>
        <div class="poem-dropzone" id="poem-box">
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                사진에 대고
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                사진을 찍는다
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>사진을 찍은 사진은</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>사진의 정의에 부합하는</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>진짜 사진이다</p>
            </div> <br>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>마침 사진 속에서</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>나체의 여인이 걸어 나온다</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>그녀는 비에 흠뻑 젖었다</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>입에 벼락을 물고 나타났다</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>관능적인 천변의 누드</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>창밖에 멀리 날아가지 못 한</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>철새들의 사체가 쌓여 있다</p>
            </div><br>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>그녀가 입을 열자</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>사람들은 우산을 찾아 허둥댄다</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>우산의 뼈를 살이라고 부르는 것만큼</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>우스운 일도 없어요</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>그렇담 인간의 뼈는 언제 살이 되나?</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>빗물이 턱끝까지 차올랐다</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>벽이 녹아내리며</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>철새들의 흉한 몰골이 드러났다</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>렌즈처럼 반짝이는</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>수면 위로</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>환영받지 못 한 밀항자들의</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>몽타주가 드리운다</p>
            </div><br>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>사진전에 모인 사람들을 두고</p>
            </div>
            <div id="draggable" draggable="true" ondragstart="event.dataTransfer.setData('text/plain',null)">
                <p>사진 찍는 소리가 들린다</p>
            </div>
        </div>
    </div>

    <script>
        var dragged;
        var prevElem;
        var leftWeight = 0;
        var rightWeight = 0;
        var totalWeight = 0;
        var leftORright; // possitive = left / nagative = right
        var poemElem = document.querySelectorAll('#draggable');
        var poemBox = document.querySelector('#poem-box');

        function addPoemClassNum() {
            for (var i = 0; i < poemElem.length; i++) {
                poemElem[i].classList.add(i + 1);
                // console.log("elem", i + 1, "add class");
            }
        }
        addPoemClassNum();

        function crash() {
            console.log('균형이 깨졌습니다.');
            // reset field
        }



        /* events fired on the draggable target */
        document.addEventListener("drag", function (event) {
            // console.log('drag');
        }, false);

        document.addEventListener("dragstart", function (event) {
            // store a ref. on the dragged elem
            dragged = event.target;
            // make it half transparent
            event.target.style.opacity = .5;
            // console.log('dragstart');
        }, false);

        document.addEventListener("dragend", function (event) {
            // reset the transparency
            event.target.style.opacity = "";
            // console.log('dragend');
        }, false);

        /* events fired on the drop targets */
        document.addEventListener("dragover", function (event) {
            // prevent default to allow drop
            event.preventDefault();
            // console.log('dragover');
        }, false);

        document.addEventListener("dragenter", function (event) {
            // highlight potential drop target when the draggable element enters it
            if (event.target.className == "dropzone") {
                event.target.style.background = "purple";
            }
            // console.log('dragenter');
        }, false);

        document.addEventListener("dragleave", function (event) {
            // reset background of potential drop target when the draggable element leaves it
            if (event.target.className == "dropzone") {
                event.target.style.background = "";
            }
            // console.log('dragleave');
        }, false);




        document.addEventListener("drop", function (event) {
            var prevParentElem = dragged.parentNode; //출발지
            var nowParentElem = event.target; //목적지

            if (nowParentElem.parentNode.id == draggable) {
                false;
            }
            event.preventDefault();
            // prevent default action (open as link for some elements)
            // console.log('this is', event.target.id);


            if (Math.abs(leftWeight - rightWeight) >= 3) {
                if (leftWeight > rightWeight) { //만약 왼쪽에서 깨졌을 경우 목적지가 왼쪽이 아닌것 다 가능
                    console.log(nowParentElem);
                    if (!(nowParentElem.className == "left-dropzone")) {
                        nowParentElem.style.background = "";
                        dragged.parentNode.removeChild(dragged);
                        nowParentElem.appendChild(dragged);
                        if (prevParentElem.className == "left-dropzone") {
                            leftWeight--;
                            if (nowParentElem.className == "right-dropzone") {
                                rightWeight++;
                            }
                        }
                        if (prevParentElem.className == "right-dropzone") {
                            rightWeight--;
                        }
                        if (prevParentElem.className == "poem-dropzone") {
                            if (nowParentElem.className == "poem-dropzone") {
                                false;
                            }
                        }
                        totalWeight = leftWeight + rightWeight;
                        console.log('L', leftWeight, 'R', rightWeight, 'total', totalWeight);
                    } else { // 왼쪽에서 깨졌는데 왼쪽이다? 끝
                        console.log('왼쪽깨짐이벤트');
                        crash();
                        false;
                    }
                }
                if (leftWeight < rightWeight) { //만약 오른쪽에서 깨졌을 경우 목적지가 오른쪽이 아닌것 다 가능
                    console.log(nowParentElem);
                    if (!(nowParentElem.className == "right-dropzone")) {
                        nowParentElem.style.background = "";
                        dragged.parentNode.removeChild(dragged);
                        nowParentElem.appendChild(dragged);
                        if (prevParentElem.className == "right-dropzone") {
                            rightWeight--;
                            if (nowParentElem.className == "left-dropzone") {
                                leftWeight++;
                            }
                        }
                        if (prevParentElem.className == "left-dropzone") {
                            leftWeight--;
                        }
                        if (prevParentElem.className == "poem-dropzone") {
                            if (nowParentElem.className == "poem-dropzone") {
                                false;
                            }
                        }
                        totalWeight = leftWeight + rightWeight;
                        console.log('L', leftWeight, 'R', rightWeight, 'total', totalWeight);
                    } else { // 오른쪽에서 깨졌는데 오른쪽이다? 끝
                        console.log('오른쪽깨짐이벤트');
                        crash();
                        false;
                    }

                }

            } else { // 평상시
                console.log('normal');
                if (prevParentElem.className == "poem-dropzone") {
                    if (nowParentElem.className == "poem-dropzone") {
                        console.log("P P");
                        false;
                    }
                    if (nowParentElem.className == "left-dropzone") {
                        nowParentElem.style.background = "";
                        dragged.parentNode.removeChild(dragged);
                        nowParentElem.appendChild(dragged);
                        leftWeight++;
                    }
                    if (nowParentElem.className == "right-dropzone") {
                        nowParentElem.style.background = "";
                        dragged.parentNode.removeChild(dragged);
                        nowParentElem.appendChild(dragged);
                        rightWeight++;
                    }
                };
                if (nowParentElem.className == "left-dropzone" ) {
                    console.log("FF");
                    nowParentElem.style.background = "";
                    dragged.parentNode.removeChild(dragged);
                    nowParentElem.appendChild(dragged);
                    if (prevParentElem.className == "left-dropzone") {
                        leftWeight--;
                        if (nowParentElem.className == "right-dropzone") {
                            rightWeight++;
                        }
                    }
                    if (prevParentElem.className == "right-dropzone") {
                        rightWeight--;
                    }
                }
                if (nowParentElem.className == "right-dropzone") {
                    console.log("FF");
                    nowParentElem.style.background = "";
                    dragged.parentNode.removeChild(dragged);
                    nowParentElem.appendChild(dragged);
                    if (prevParentElem.className == "right-dropzone") {
                        rightWeight--;
                        if (nowParentElem.className == "left-dropzone") {
                            leftWeight++;
                        }
                    }
                    if (prevParentElem.className == "left-dropzone") {
                        leftWeight--;
                    }
                }

                totalWeight = leftWeight + rightWeight;
                console.log('L', leftWeight, 'R', rightWeight, 'total', totalWeight);
            }

        }, false);
    </script>
</body>

</html>